import React, { useState, useEffect, useRef } from 'react';
import loadGif from '../src/assets/load.gif'

import './App.css';

interface UserProps {
  user: string;
  email: string;
}

function App() {

  const [newUser, setNewUser] = useState('');
  const [newEmail, setNewEmail] = useState('');

  const [info, setInfo] = useState<UserProps>({
    user: newUser,
    email: newEmail,
  });

  const [isLoad, setIsLoad] = useState(true)

  useEffect(
    () =>{

      setTimeout(
        () =>{
          setIsLoad(false)
        }, 1500
      )

    },[]
  )

  useEffect(
    ()=>{
      
      const userSave = localStorage.getItem("@WSimpsom")

      if(userSave){
        setInfo(JSON.parse(userSave))
      }

      console.log(userSave)
    }
    ,[]
  )

  const handleShowInfo = (e: React.FormEvent): void => {
    e.preventDefault();

    const oneUser: UserProps = {
      user: newUser,
      email: newEmail,
    };

    setInfo(oneUser);

    // Agora, o console.log é chamado após a atualização do estado, exibindo o valor novo.
    console.log(oneUser);

    setNewUser('');
    setNewEmail('');

    localStorage.setItem('@WSimpsom', JSON.stringify(info))
  };

  if(isLoad){
    return(
      <div>
        <img src={loadGif} alt="gif load" />
      </div>
    )
  }

  return (
    <>
      <div>
        
        <hr />
        <strong>UseEffect and UseState</strong>
        <hr />
      </div>
      <br />
      <div>
        <form onSubmit={handleShowInfo}>
          <label>User: </label>
          <input
            type="text"
            value={newUser}
            onChange={(e) => setNewUser(e.target.value)}
          />
          <label>Email: </label>
          <input
            type="text"
            value={newEmail}
            onChange={(e) => setNewEmail(e.target.value)}
          />
          <br />
          <br />
          <button type="submit">Salvar</button>
        </form>
      </div>

      <div>
        <br /> <hr />
        <strong>Ultimo usuário cadastrado:</strong>
        <br />
        <h4>{info?.user}</h4>
        <h4>{info?.email}</h4>
      </div>
    </>
  );
}

export default App;